.title
	%h2 Export
	%h1= export_title
	= link_for :cancel, controller_model

.scroller

	- if params[:export_kind]
		= semantic_form_for @export, export_form_attributes do |f|
			- if @export.valid? && params[:export_kind] != 'request'
				%p This export cannot be used:
				%ul.errors
					- @export.errors.full_messages.each do |error|
						%li= error
			
			- else
				%p #{pluralize @export.student_ids.count, 'student'} selected.
				- @export.student_ids.each do |id|
					= hidden_field_tag 'export[student_ids][]', id
				
				- if params[:export_kind] == 'request'
					= f.inputs do
						= f.input :certificate_title
						= f.input :distribution_date
						= f.input :additional_information, as: :text
						= hidden_field_tag :commit, 'Send'
					
					= f.actions do
						= f.action :submit, label: 'Send'
				
				- else
					- if @export.student_ids.count > 1
						= f.inputs do
							= f.input :sort_by, collection: Student.sort_options
					
					- if @export.template && @export.template.prompts.any?
						%p Please fill in the appropriate values for the following fields.
						= f.inputs do
							- @export.template.prompts.each do |field|
								= f.semantic_fields_for :prompt_values do |a|
									= a.input field.name

					= f.actions do
						= f.action :submit
				
	- else
		%h6 Request
		= link_to 'Send a Request', export_path(kind: 'request')
		- if available_types.any?
			%h6 Templates
			- available_types.each do |type|
				= link_to type.name, export_path(kind: 'print', id: type.id)
		- if permitted_to?(:zpass, controller_model)
			%h6 Zpass
			= link_to 'Zpass', export_path(kind: 'zpass')