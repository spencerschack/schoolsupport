<div class="title">
  <h2><%= term_filter %></h2>
  <h1>Test Scores</h1>
  <%= link_for :fullscreen, controller_model %>
  <%= link_for :import, controller_model %>
  <%= link_for :search, controller_model %>
</div>
  
<div class="scroller">
  <div class="table" data-offset="<%= params[:offset].to_i + offset_amount %>">
    <div>
      <span class="spacer"></span>
      <span class="thumbnail"></span>
      <span data-order-by="students.identifier" class="sortable">Identifier</span>
      <span data-order-by="students.last_name" class="sortable">Name</span>
      <span data-order-by="students.grade" class="sortable replace_target">Grade</span>
      <% score_columns.each do |test_name, terms_and_keys| %>
        <% terms_and_keys.each do |term, keys| %>
          <% keys.each do |key| %>
            <span <%= data_column_attributes(test_name, term, key) %>>
              <em><%= test_name.upcase %> <%= term %></em>
              <i><%= key.titleize %></i>
            </span>
          <% end %>
        <% end %>
      <% end %>
      <span class="spacer"></span>
    </div>
    <% collection.each do |student| %>
      <a href="<%= "#{request.path}/#{student.id}" %>" data-id="<%= student.id %>">
        <span class="spacer"></span>
        <span class="thumbnail">
          <%= image_tag(student.image(:thumbnail)) if student.image? %>
        </span>
        <span><%= student.identifier %></span>
        <span><%= student.name %></span>
        <span><%= student.grade %></span>
        <% ordered_test_scores(student.test_scores) do |score| %>
          <% score_columns[score.test_name.downcase].each do |term, keys| %>
            <% keys.each do |key| %>
              <% if level = score.data["#{key}_lv"] %>
                <span class="<%= level.downcase %>">
                  <%= score.data[key] || none %>
                  <i><%= level %></i>
                </span>
              <% else %>
                <span><%= score.data[key] || none %></span>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
        <span class="spacer"></span>
      </a>
    <% end %>
  </div>
</div>